- [Video uploading](#video-uploading)
- [Video preprocessing](#video-preprocessing)
  - [Async upload](#async-upload)
  - [Resumable upload](#resumable-upload)
- [Video streaming flow](#video-streaming-flow)
  - [Adaptive bitrate segmentation](#adaptive-bitrate-segmentation)

# Video uploading
* Video is uploaded to storage directly, not passing web server to save bandwidth. 

![Upload video](../.gitbook/assets/youtube_flowchart.png)

# Video preprocessing
* Components:
  * Inspection: Make sure videos have good quality and not malformed.
  * Video transcoding: Videos are converted to support different container/codec. 
  * Thumbnail: Can be manually uploaded by the user or automatically generated by the system.
  * Watermark: An image overlay on top of your video contains identifying information about your video. 

![Video processing](../.gitbook/assets/youtube_video_videoProcessingAtFBScale.png)

* Video transcoding is to 
  * Raw video consumes large amount of storage space. 
  * Many browsers and devices only support certain form of encoding.

## Async upload

* Introduce message queue between component to make the process asynchronous. 
  * The encoding module does not need to wait for the download module. 
  * The upload module does not need to wait for encoding module. 

![Serial upload](../.gitbook/assets//youtube_video_optimization_serialUpload.png)

![Parallel upload](../.gitbook/assets/youtube_video_optimization_parallelUpload.png)

## Resumable upload

* Flowchart

![](../.gitbook/assets/online_video_Resumable-Media-Upload-Sequence-Diagram.png)

* References:
  * Youtube: [https://developers.google.com/youtube/v3/guides/using_resumable_upload_protocol](https://developers.google.com/youtube/v3/guides/using_resumable_upload_protocol)
  * GoogleDrive: [https://developers.google.com/drive/api/v3/manage-uploads#resumable](https://developers.google.com/drive/api/v3/manage-uploads#resumable)
  * [https://googleapis.github.io/google-api-java-client/media-upload.html](https://googleapis.github.io/google-api-java-client/media-upload.html)


# Video streaming flow

![Video streaming](../.gitbook/assets//youtube_highlevel_overview.png)

## Adaptive bitrate segmentation

* Video could be encoded into different resolution frames. In terms of which frames to play, it could be decided based on the network speed. 

![](../.gitbook/assets/youtube_videoformats_bitrate_context.png)

![](../.gitbook/assets/youtube_videoformats_bitrate_segmentation.png)

